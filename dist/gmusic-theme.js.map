{"version":3,"sources":["../src/gmusic-theme.js"],"names":["fs","require","COMMON_CSS","readFileSync","__dirname","HIGHLIGHT_CSS","FULL_CSS","BASE_SVG","CONSTANTS","DEFAULTS","BACK_PRIMARY","BACK_SECONDARY","BACK_HIGHLIGHT","FORE_PRIMARY","FORE_SECONDARY","GMusicTheme","options","enabled","type","TYPES","FULL","styleElement","document","createElement","body","appendChild","updateTheme","_refreshStyleSheet","_drawLogo","documentElement","classList","add","CLASS_NAMESPACE","remove","redrawTheme","colorObject","undefined","validTypesStr","JSON","stringify","Object","keys","Error","backPrimary","backSecondary","backHighlight","forePrimary","foreSecondary","logo","querySelectorAll","normalSVG","customSVG","replace","parent","tmpSVG","parentNode","logoObserver","disconnect","nodeName","id","getAttribute","removeChild","DOMParser","parseFromString","firstChild","setAttribute","MutationObserver","observe","childList","attributes","subtree","setTimeout","styles","HIGHLIGHT_ONLY","innerHTML","substituteColors","colorCode","opacity","clearer","rgbString","percentage","darken","rgb","r","g","b","styleString","s","n","colorString","_darken","parseFloat","_rgba","_inverse","module","exports"],"mappings":"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","file":"gmusic-theme.js","sourcesContent":["import color from 'color';\r\n\r\nconst fs = require('fs');\r\n\r\n// DEV: These constants will be transformed into string constants by browserify\r\nconst COMMON_CSS = fs.readFileSync(`${__dirname}/../build/common.css`, 'utf8');\r\nconst HIGHLIGHT_CSS = fs.readFileSync(`${__dirname}/../build/highlight.css`, 'utf8');\r\nconst FULL_CSS = fs.readFileSync(`${__dirname}/../build/full.css`, 'utf8');\r\nconst BASE_SVG = fs.readFileSync(`${__dirname}/../lib/logo.svg`, 'utf8');\r\nconst CONSTANTS = require('../lib/_constants');\r\n\r\nconst DEFAULTS = {\r\n  BACK_PRIMARY: '#222326',\r\n  BACK_SECONDARY: '#121314',\r\n  BACK_HIGHLIGHT: '#615F59', // #1a1b1d\r\n  FORE_PRIMARY: '#FFFFFF',\r\n  FORE_SECONDARY: '#FF5722',\r\n};\r\n\r\nclass GMusicTheme {\r\n  static TYPES = {\r\n    FULL: 'FULL',\r\n    HIGHLIGHT_ONLY: 'HIGHLIGHT_ONLY',\r\n  };\r\n\r\n  /**\r\n   * Constructor for a new Google Music Theme API.\r\n   *\r\n   * @param  {Object} - A colors object containing `backPrimary`, `backSecondary`,\r\n   *                    `backHighlight`, `forePrimary`, `foreSecondary` attributes\r\n   *                    any attribute not included will not be overriden\r\n   */\r\n  constructor(options = {}) {\r\n    // DEV: Use the colors specified in the options or the default if it isn't set\r\n    this.BACK_PRIMARY = DEFAULTS.BACK_PRIMARY;\r\n    this.BACK_SECONDARY = DEFAULTS.BACK_SECONDARY;\r\n    this.BACK_HIGHLIGHT = DEFAULTS.BACK_HIGHLIGHT;\r\n    this.FORE_PRIMARY = DEFAULTS.FORE_PRIMARY;\r\n    this.FORE_SECONDARY = DEFAULTS.FORE_SECONDARY;\r\n    this.enabled = options.enabled || false;\r\n    this.type = GMusicTheme.TYPES.FULL;\r\n\r\n    // DEV: This is the style element where we put our custom CSS\r\n    this.styleElement = document.createElement('style');\r\n    document.body.appendChild(this.styleElement);\r\n\r\n    // DEV: updateTheme calls redrawTheme\r\n    this.updateTheme(options);\r\n  }\r\n\r\n  /**\r\n   * Regenerates the custom CSS and and updates the SVG logo\r\n   */\r\n  redrawTheme() {\r\n    this._refreshStyleSheet();\r\n    this._drawLogo();\r\n\r\n    // DEV: Add / Remove appropriate classes\r\n    if (this.enabled) {\r\n      document.documentElement.classList.add(CONSTANTS.CLASS_NAMESPACE);\r\n    } else {\r\n      document.documentElement.classList.remove(CONSTANTS.CLASS_NAMESPACE);\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Enabled the custom theme\r\n  */\r\n  enable() {\r\n    this.enabled = true;\r\n    this.redrawTheme();\r\n  }\r\n\r\n  /**\r\n   * Disables the custom theme\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n    this.redrawTheme();\r\n  }\r\n\r\n  /**\r\n   * Updates the custom colors used in the theme and redraws the custom CSS\r\n   *\r\n   * @param  {Object} - A colors object containing `backPrimary`, `backSecondary`,\r\n   *                    `backHighlight`, `forePrimary`, `foreSecondary` attributes\r\n   *                    any attribute not included will not be overriden\r\n   */\r\n  updateTheme(colorObject) {\r\n    // DEV: Validate the updateTheme type\r\n    if (colorObject.type !== undefined && GMusicTheme.TYPES[colorObject.type] === undefined) {\r\n      const validTypesStr = JSON.stringify(Object.keys(GMusicTheme.TYPES));\r\n      throw new Error(`\\`updateTheme\\` expected \\`colorObject.type\\` to be in ${validTypesStr}\r\n        but it was \"${colorObject.type}\"`);\r\n    }\r\n    this.BACK_PRIMARY = colorObject.backPrimary || this.BACK_PRIMARY;\r\n    this.BACK_SECONDARY = colorObject.backSecondary || this.BACK_SECONDARY;\r\n    this.BACK_HIGHLIGHT = colorObject.backHighlight || this.BACK_HIGHLIGHT;\r\n    this.FORE_PRIMARY = colorObject.forePrimary || this.FORE_PRIMARY;\r\n    this.FORE_SECONDARY = colorObject.foreSecondary || this.FORE_SECONDARY;\r\n    this.type = colorObject.type || this.type;\r\n    this.redrawTheme();\r\n  }\r\n\r\n  _drawLogo() {\r\n    const logo = document.querySelectorAll('.menu-logo')[0];\r\n    const normalSVG = BASE_SVG;\r\n    const customSVG = normalSVG.replace('#EE6B00', this.FORE_SECONDARY).replace('id=\"normalSVGIcon\"', 'id=\"customSVGIcon\"');\r\n    let parent;\r\n    let tmpSVG;\r\n\r\n    if (logo) {\r\n      parent = logo.parentNode;\r\n      if (this.logoObserver) {\r\n        this.logoObserver.disconnect();\r\n        delete this.logoObserver;\r\n      }\r\n\r\n      if (this.enabled) {\r\n        // DEV: Only update the SVG element if we need to\r\n        if (logo.nodeName === 'IMG' || logo.id === 'normalSVGIcon' || logo.getAttribute('current-custom') !== this.FORE_SECONDARY) {\r\n          parent.removeChild(logo);\r\n          tmpSVG = (new DOMParser()).parseFromString(customSVG, 'text/xml').firstChild;\r\n          tmpSVG.setAttribute('current-custom', this.FORE_SECONDARY);\r\n          parent.appendChild(tmpSVG);\r\n        }\r\n      } else if (logo.nodeName === 'IMG' || logo.id === 'customSVGIcon') {\r\n        // DEV: Only update the SVG element if we need to\r\n        parent.removeChild(logo);\r\n        parent.appendChild((new DOMParser()).parseFromString(normalSVG, 'text/xml').firstChild);\r\n      }\r\n\r\n      // DEV: Google sometimes changes its logo by itself, we need to monitor this\r\n      this.logoObserver = new MutationObserver(() => {\r\n        this._drawLogo();\r\n      });\r\n      this.logoObserver.observe(parent, {\r\n        childList: true,\r\n        attributes: true,\r\n        subtree: true,\r\n      });\r\n    } else {\r\n      // DEV: If the logo isn't ready yet wait a few milliseconds and try again\r\n      setTimeout(this._drawLogo, 10);\r\n    }\r\n  }\r\n\r\n  _refreshStyleSheet() {\r\n    // DEV: Take the current style string and put it in the style element in the DOM)\r\n    let styles = COMMON_CSS;\r\n    switch (this.type) {\r\n      case GMusicTheme.TYPES.FULL:\r\n        styles += FULL_CSS;\r\n        break;\r\n      case GMusicTheme.TYPES.HIGHLIGHT_ONLY:\r\n        styles += HIGHLIGHT_CSS;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    this.styleElement.innerHTML = this.substituteColors(styles);\r\n  }\r\n\r\n  _rgba(colorCode, opacity) {\r\n    return color(colorCode).clearer(opacity).rgbString();\r\n  }\r\n\r\n  _darken(colorCode, percentage) {\r\n    return color(colorCode).darken(percentage).rgbString();\r\n  }\r\n\r\n  _inverse(colorCode) {\r\n    const rgb = color(colorCode).rgb();\r\n    return color({\r\n      r: 255 - rgb.r,\r\n      g: 255 - rgb.g,\r\n      b: 255 - rgb.b,\r\n    }).rgbString();\r\n  }\r\n\r\n  substituteColors(styleString) {\r\n    return styleString\r\n      .replace(/<<BACK_PRIMARY>>/g, this.BACK_PRIMARY)\r\n      .replace(/<<BACK_SECONDARY>>/g, this.BACK_SECONDARY)\r\n      .replace(/<<BACK_HIGHLIGHT>>/g, this.BACK_HIGHLIGHT)\r\n      .replace(/<<FORE_PRIMARY>>/g, this.FORE_PRIMARY)\r\n      .replace(/<<FORE_SECONDARY>>/g, this.FORE_SECONDARY)\r\n      .replace(/<<DARKEN ([01]+.?[0-9]*)>>(.+?)<<\\/DARKEN>>/g, (s, n, colorString) => this._darken(colorString, parseFloat(n)))\r\n      .replace(/<<ALPHA ([01]+.?[0-9]*)>>(.+?)<<\\/ALPHA>>/g, (s, n, colorString) => this._rgba(colorString, parseFloat(n)))\r\n      .replace(/<<INVERSE>>(.+?)<<\\/INVERSE>>/g, (s, colorString) => this._inverse(colorString))\r\n      .replace(/<<NOTIMPORTANT>> !important/g, '');\r\n  }\r\n}\r\n\r\nmodule.exports = GMusicTheme;\r\n"]}