{"version":3,"sources":["../src/gmusic-theme.js"],"names":[],"mappings":"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","file":"gmusic-theme.js","sourcesContent":["import color from 'color';\n\nconst fs = require('fs');\n\n// DEV: These constants will be transformed into string constants by browserify\nconst COMMON_CSS = fs.readFileSync(`${__dirname}/../build/common.css`, 'utf8');\nconst HIGHLIGHT_CSS = fs.readFileSync(`${__dirname}/../build/highlight.css`, 'utf8');\nconst FULL_CSS = fs.readFileSync(`${__dirname}/../build/full.css`, 'utf8');\nconst BASE_SVG = fs.readFileSync(`${__dirname}/../lib/logo.svg`, 'utf8');\nconst CONSTANTS = require('../lib/_constants');\n\nconst DEFAULTS = {\n  BACK_PRIMARY: '#222326',\n  BACK_SECONDARY: '#121314',\n  BACK_HIGHLIGHT: '#615F59', // #1a1b1d\n  FORE_PRIMARY: '#FFFFFF',\n  FORE_SECONDARY: '#FF5722',\n};\n\nclass GMusicTheme {\n  static TYPES = {\n    FULL: 'FULL',\n    HIGHLIGHT_ONLY: 'HIGHLIGHT_ONLY',\n  };\n\n  /**\n   * Constructor for a new Google Music Theme API.\n   *\n   * @param  {Object} - A colors object containing `backPrimary`, `backSecondary`,\n   *                    `backHighlight`, `forePrimary`, `foreSecondary` attributes\n   *                    any attribute not included will not be overriden\n   */\n  constructor(options = {}) {\n    // DEV: Use the colors specified in the options or the default if it isn't set\n    this.BACK_PRIMARY = DEFAULTS.BACK_PRIMARY;\n    this.BACK_SECONDARY = DEFAULTS.BACK_SECONDARY;\n    this.BACK_HIGHLIGHT = DEFAULTS.BACK_HIGHLIGHT;\n    this.FORE_PRIMARY = DEFAULTS.FORE_PRIMARY;\n    this.FORE_SECONDARY = DEFAULTS.FORE_SECONDARY;\n    this.enabled = options.enabled || false;\n    this.type = GMusicTheme.TYPES.FULL;\n\n    // DEV: This is the style element where we put our custom CSS\n    this.styleElement = document.createElement('style');\n    document.body.appendChild(this.styleElement);\n\n    // DEV: updateTheme calls redrawTheme\n    this.updateTheme(options);\n  }\n\n  /**\n   * Regenerates the custom CSS and and updates the SVG logo\n   */\n  redrawTheme() {\n    this._refreshStyleSheet();\n    this._drawLogo();\n\n    // DEV: Add / Remove appropriate classes\n    if (this.enabled) {\n      document.documentElement.classList.add(CONSTANTS.CLASS_NAMESPACE);\n    } else {\n      document.documentElement.classList.remove(CONSTANTS.CLASS_NAMESPACE);\n    }\n  }\n\n  /**\n  * Enabled the custom theme\n  */\n  enable() {\n    this.enabled = true;\n    this.redrawTheme();\n  }\n\n  /**\n   * Disables the custom theme\n   */\n  disable() {\n    this.enabled = false;\n    this.redrawTheme();\n  }\n\n  /**\n   * Updates the custom colors used in the theme and redraws the custom CSS\n   *\n   * @param  {Object} - A colors object containing `backPrimary`, `backSecondary`,\n   *                    `backHighlight`, `forePrimary`, `foreSecondary` attributes\n   *                    any attribute not included will not be overriden\n   */\n  updateTheme(colorObject) {\n    // DEV: Validate the updateTheme type\n    if (colorObject.type !== undefined && GMusicTheme.TYPES[colorObject.type] === undefined) {\n      const validTypesStr = JSON.stringify(Object.keys(GMusicTheme.TYPES));\n      throw new Error(`\\`updateTheme\\` expected \\`colorObject.type\\` to be in ${validTypesStr}\n        but it was \"${colorObject.type}\"`);\n    }\n    this.BACK_PRIMARY = colorObject.backPrimary || this.BACK_PRIMARY;\n    this.BACK_SECONDARY = colorObject.backSecondary || this.BACK_SECONDARY;\n    this.BACK_HIGHLIGHT = colorObject.backHighlight || this.BACK_HIGHLIGHT;\n    this.FORE_PRIMARY = colorObject.forePrimary || this.FORE_PRIMARY;\n    this.FORE_SECONDARY = colorObject.foreSecondary || this.FORE_SECONDARY;\n    this.type = colorObject.type || this.type;\n    this.redrawTheme();\n  }\n\n  _drawLogo() {\n    const logo = document.querySelectorAll('.menu-logo')[0];\n    const normalSVG = BASE_SVG;\n    const customSVG = normalSVG.replace('#EE6B00', this.FORE_SECONDARY).replace('id=\"normalSVGIcon\"', 'id=\"customSVGIcon\"');\n    let parent;\n    let tmpSVG;\n\n    if (logo) {\n      parent = logo.parentNode;\n      if (this.logoObserver) {\n        this.logoObserver.disconnect();\n        delete this.logoObserver;\n      }\n\n      if (this.enabled) {\n        // DEV: Only update the SVG element if we need to\n        if (logo.nodeName === 'IMG' || logo.id === 'normalSVGIcon' || logo.getAttribute('current-custom') !== this.FORE_SECONDARY) {\n          parent.removeChild(logo);\n          tmpSVG = (new DOMParser()).parseFromString(customSVG, 'text/xml').firstChild;\n          tmpSVG.setAttribute('current-custom', this.FORE_SECONDARY);\n          parent.appendChild(tmpSVG);\n        }\n      } else if (logo.nodeName === 'IMG' || logo.id === 'customSVGIcon') {\n        // DEV: Only update the SVG element if we need to\n        parent.removeChild(logo);\n        parent.appendChild((new DOMParser()).parseFromString(normalSVG, 'text/xml').firstChild);\n      }\n\n      // DEV: Google sometimes changes its logo by itself, we need to monitor this\n      this.logoObserver = new MutationObserver(() => {\n        this._drawLogo();\n      });\n      this.logoObserver.observe(parent, {\n        childList: true,\n        attributes: true,\n        subtree: true,\n      });\n    } else {\n      // DEV: If the logo isn't ready yet wait a few milliseconds and try again\n      setTimeout(this._drawLogo, 10);\n    }\n  }\n\n  _refreshStyleSheet() {\n    // DEV: Take the current style string and put it in the style element in the DOM)\n    let styles = COMMON_CSS;\n    switch (this.type) {\n      case GMusicTheme.TYPES.FULL:\n        styles += FULL_CSS;\n        break;\n      case GMusicTheme.TYPES.HIGHLIGHT_ONLY:\n        styles += HIGHLIGHT_CSS;\n        break;\n      default:\n        break;\n    }\n    this.styleElement.innerHTML = this.substituteColors(styles);\n  }\n\n  _rgba(colorCode, opacity) {\n    return color(colorCode).clearer(opacity).rgbString();\n  }\n\n  _darken(colorCode, percentage) {\n    return color(colorCode).darken(percentage).rgbString();\n  }\n\n  _inverse(colorCode) {\n    const rgb = color(colorCode).rgb();\n    return color({\n      r: 255 - rgb.r,\n      g: 255 - rgb.g,\n      b: 255 - rgb.b,\n    }).rgbString();\n  }\n\n  substituteColors(styleString) {\n    return styleString\n      .replace(/<<BACK_PRIMARY>>/g, this.BACK_PRIMARY)\n      .replace(/<<BACK_SECONDARY>>/g, this.BACK_SECONDARY)\n      .replace(/<<BACK_HIGHLIGHT>>/g, this.BACK_HIGHLIGHT)\n      .replace(/<<FORE_PRIMARY>>/g, this.FORE_PRIMARY)\n      .replace(/<<FORE_SECONDARY>>/g, this.FORE_SECONDARY)\n      .replace(/<<DARKEN ([01]+.?[0-9]*)>>(.+?)<<\\/DARKEN>>/g, (s, n, colorString) => this._darken(colorString, parseFloat(n)))\n      .replace(/<<ALPHA ([01]+.?[0-9]*)>>(.+?)<<\\/ALPHA>>/g, (s, n, colorString) => this._rgba(colorString, parseFloat(n)))\n      .replace(/<<INVERSE>>(.+?)<<\\/INVERSE>>/g, (s, colorString) => this._inverse(colorString))\n      .replace(/<<NOTIMPORTANT>> !important/g, '');\n  }\n}\n\nmodule.exports = GMusicTheme;\n"]}